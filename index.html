<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Budget Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<style>
:root {
  --bg-color: #f9f9f9; --text-color:#333; --card-bg:#fff;
}
body.dark { --bg-color:#121212; --text-color:#eee; --card-bg:#1e1e1e; }
body { font-family: Arial, sans-serif; margin:0; padding:0; background:var(--bg-color); color:var(--text-color);}
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:var(--card-bg); box-shadow:0 2px 5px rgba(0,0,0,0.1); position:sticky; top:0;}
.container { max-width:1000px; margin:auto; padding:20px;}
.card { background:var(--card-bg); border-radius:10px; padding:15px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
h2{margin-top:0;}
input, select, button { padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ccc; width:100%; box-sizing:border-box;}
button{background:#007bff;color:white;cursor:pointer;border:none;}
button:hover{background:#0056b3;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px;}
th, td{border:1px solid #ccc;padding:8px;text-align:left;}
th{background:#f0f0f0;}
body.dark th{background:#222;}
canvas{max-width:100%;height:auto;}
.toggle{cursor:pointer;padding:6px 12px;border-radius:20px;background:#007bff;color:white;font-size:14px;}
.month-nav{display:flex;justify-content:center;align-items:center; margin-bottom:10px;}
.month-nav button{margin:0 10px;}
@media(max-width:600px){h2{font-size:18px;} table, th, td{font-size:12px;}}
</style>
</head>
<body>
<header>
<h1>Smart Budget</h1>
<span class="toggle" onclick="toggleDark()">ðŸŒ™ Toggle</span>
</header>
<div class="container">

<div class="month-nav">
  <button onclick="prevMonth()">â—€ Prev</button>
  <span id="monthYearLabel" style="font-weight:bold;"></span>
  <button onclick="nextMonth()">Next â–¶</button>
</div>

<div class="card">
  <h2>Add Transaction</h2>
  <input type="date" id="tranDate">
  <input type="text" id="tranDesc" placeholder="Description">
  <input type="number" id="tranAmount" placeholder="Amount â‚¹">
  <select id="tranType">
    <option value="Expense">Expense</option>
    <option value="Income">Income</option>
  </select>
  <select id="tranCategory">
    <option>Food</option>
    <option>Travel</option>
    <option>Shopping</option>
    <option>Bills</option>
    <option>Tithe</option>
    <option>Salary</option>
    <option>Others</option>
  </select>
  <button onclick="addTransaction()">Add</button>
</div>

<div class="card">
  <h2>Transaction List</h2>
  <table>
    <thead><tr><th>Date</th><th>Description</th><th>Type</th><th>Category</th><th>Amount</th></tr></thead>
    <tbody id="transactionTable"></tbody>
  </table>
</div>

<div class="card">
  <h2>Overview</h2>
  <p><b>Monthly Salary:</b> â‚¹28,000</p>
  <p><b>Monthly Total Income:</b> â‚¹<span id="totalInc">0</span></p>
  <p><b>Monthly Total Expenses:</b> â‚¹<span id="totalExp">0</span></p>
  <p><b>Remaining Balance:</b> â‚¹<span id="remainingBal">28000</span></p>
  <p><b>Cumulative Savings:</b> â‚¹<span id="cumSavings">0</span></p>
  <p id="alertMsg" style="color:red;font-weight:bold;"></p>
</div>

<div class="card">
<h2>Category Chart</h2>
<canvas id="categoryChart"></canvas>
</div>

</div>

<script>
function toggleDark(){ document.body.classList.toggle("dark"); }

const firebaseConfig = {
  apiKey: "AIzaSyCDAMWFFDy3mgzbiGzqNdm7idHVUZ8tPoI",
  authDomain: "smartbudget-1ecac.firebaseapp.com",
  databaseURL: "https://smartbudget-1ecac-default-rtdb.firebaseio.com",
  projectId: "smartbudget-1ecac",
  storageBucket: "smartbudget-1ecac.firebasestorage.app",
  messagingSenderId: "758176413916",
  appId: "1:758176413916:web:9c3fe710d752b5371c1c19"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currDate = new Date();
let month = currDate.getMonth();
let year = currDate.getFullYear();

const SALARY = 28000;
let categoryChart;

function updateMonthYearLabel(){
  const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
  document.getElementById("monthYearLabel").innerText = monthNames[month]+" "+year;
}
updateMonthYearLabel();

function prevMonth(){ month--; if(month<0){month=11; year--;} updateMonthYearLabel(); loadTransactions(); }
function nextMonth(){ month++; if(month>11){month=0; year++;} updateMonthYearLabel(); loadTransactions(); }

function addTransaction(){
  const dateStr = document.getElementById("tranDate").value;
  const desc = document.getElementById("tranDesc").value;
  const amount = +document.getElementById("tranAmount").value;
  const type = document.getElementById("tranType").value;
  const category = document.getElementById("tranCategory").value;

  if(!dateStr || !desc || !amount){ alert("Fill all fields"); return; }

  const transDate = new Date(dateStr);
  const now = new Date();
  if(transDate.getFullYear()>now.getFullYear() || (transDate.getFullYear()===now.getFullYear() && transDate.getMonth()>now.getMonth())){
    alert("ðŸš« Cannot add future transactions."); return;
  }
  if(transDate.getFullYear()<now.getFullYear() || (transDate.getFullYear()===now.getFullYear() && transDate.getMonth()<now.getMonth())){
    if(!confirm("âš ï¸ This transaction belongs to a past month. Continue?")) return;
  }

  db.ref("transactions").push({date:dateStr, desc, amount, type, category});
  document.getElementById("tranDate").value="";
  document.getElementById("tranDesc").value="";
  document.getElementById("tranAmount").value="";
}

function loadTransactions(){
  db.ref("transactions").once("value").then(snap=>{
    const data = snap.val()||{};
    let table="", totalExp=0, totalInc=0, categories={};

    Object.values(data).forEach(t=>{
      const tDate = new Date(t.date);
      if(tDate.getMonth()===month && tDate.getFullYear()===year){
        table+=`<tr><td>${t.date}</td><td>${t.desc}</td><td>${t.type}</td><td>${t.category}</td><td>â‚¹${t.amount}</td></tr>`;
        if(t.type==="Expense"){ totalExp+=t.amount; categories[t.category]=(categories[t.category]||0)+t.amount; }
        else { totalInc+=t.amount; }
      }
    });

    document.getElementById("transactionTable").innerHTML=table;
    document.getElementById("totalExp").innerText=totalExp;
    document.getElementById("totalInc").innerText=totalInc;
    const remaining = SALARY + totalInc - totalExp;
    document.getElementById("remainingBal").innerText=remaining;

    // cumulative savings
    let cum=0;
    for(let m=0;m<=month;m++){
      let mExp=0, mInc=0;
      Object.values(data).forEach(t=>{
        const d=new Date(t.date);
        if(d.getMonth()===m && d.getFullYear()===year){
          if(t.type==="Expense") mExp+=t.amount;
          else mInc+=t.amount;
        }
      });
      cum+=SALARY + mInc - mExp;
    }
    document.getElementById("cumSavings").innerText=cum;

    // Alerts
    const alertMsg = document.getElementById("alertMsg");
    if(totalExp>=20000 && totalExp<27000) alertMsg.innerText="âš ï¸ Warning: Over â‚¹20,000 spent!";
    else if(totalExp>=27000) alertMsg.innerText="ðŸš¨ Critical: High Expenses!";
    else alertMsg.innerText="";

    // category chart
    if(categoryChart) categoryChart.destroy();
    categoryChart = new Chart(document.getElementById("categoryChart"),{
      type:"pie",
      data:{labels:Object.keys(categories), datasets:[{data:Object.values(categories), backgroundColor:["#e74c3c","#3498db","#2ecc71","#f1c40f","#f39c12","#9b59b6"]}]}
    });
  });
}

loadTransactions();
</script>
</body>
</html>
