<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Budget Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<style>
:root {
  --bg-color: #f5f6fa;
  --card-bg: #fff;
  --primary-color: #4e73df;
  --secondary-color: #1cc88a;
  --text-color: #333;
  --alert-color: #e74c3c;
}
body.dark {
  --bg-color: #121212;
  --card-bg: #1e1e1e;
  --text-color: #eee;
}
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: var(--bg-color);
  color: var(--text-color);
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background: var(--card-bg);
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 10;
}
header h1 { margin: 0; font-size: 22px; color: var(--primary-color);}
.toggle {
  cursor: pointer;
  background: var(--primary-color);
  color: #fff;
  padding: 6px 12px;
  border-radius: 20px;
}
.container { max-width: 1000px; margin: auto; padding: 20px; }
.card {
  background: var(--card-bg);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}
h2 { margin-top: 0; }
input, select, button { padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; }
button { background: var(--primary-color); color: #fff; border: none; cursor: pointer; transition: 0.2s; }
button:hover { background: #2e59d9; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background: var(--primary-color); color: #fff; }
body.dark th { background: #333; }
canvas { max-width: 100%; height: auto; margin-top: 15px; }
/* Month Navigation */
.month-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  margin-bottom: 15px;
}
.month-nav button { flex: 0 0 100px; }
.month-label {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-weight: bold;
  font-size: 16px;
}
.alert { color: var(--alert-color); font-weight: bold; }
@media (max-width: 600px) {
  h2 { font-size: 18px; }
  table, th, td { font-size: 12px; }
  .month-nav button { flex: 0 0 70px; font-size: 12px;}
  .month-label { font-size: 14px;}
}
</style>
</head>
<body>
<header>
  <h1>Smart Budget</h1>
  <span class="toggle" onclick="toggleDark()">ðŸŒ™ Toggle</span>
</header>

<div class="container">
  <div class="card">
    <h2>Month Navigation</h2>
    <div class="month-nav">
      <button onclick="prevMonth()">â¬… Previous</button>
      <span class="month-label" id="currentMonth"></span>
      <button onclick="nextMonth()">Next âž¡</button>
    </div>
  </div>

  <div class="card">
    <h2>Add Expense</h2>
    <input type="date" id="date">
    <input type="text" id="desc" placeholder="Description">
    <input type="number" id="amount" placeholder="Amount â‚¹">
    <select id="category">
      <option>Food</option>
      <option>Travel</option>
      <option>Shopping</option>
      <option>Bills</option>
      <option>TAI</option>
      <option>Others</option>
    </select>
    <button onclick="addExpense()">Add</button>
    <p class="alert" id="dateAlert"></p>
  </div>

  <div class="card">
    <h2>Expense List</h2>
    <table>
      <thead><tr><th>Date</th><th>Description</th><th>Category</th><th>Amount</th></tr></thead>
      <tbody id="expenseTable"></tbody>
    </table>
  </div>

  <div class="card">
    <h2>Overview</h2>
    <p><b>Monthly Salary:</b> â‚¹28,000</p>
    <p><b>Saving Goal:</b> â‚¹15,000 â€“ â‚¹17,000</p>
    <p><b>Total Expenses:</b> â‚¹<span id="totalExpenses">0</span></p>
    <p><b>Remaining Balance:</b> â‚¹<span id="remaining">28000</span></p>
    <p><b>Cumulative Savings:</b> â‚¹<span id="cumulative">0</span></p>
  </div>

  <div class="card">
    <h2>Charts</h2>
    <canvas id="categoryChart"></canvas>
    <canvas id="prevMonthChart"></canvas>
  </div>
</div>

<script>
let current = new Date();
let month = current.getMonth();
let year = current.getFullYear();
const SALARY = 28000;
const MIN_SAVINGS = 15000;
const IDEAL_SAVINGS = 17000;
let expenses = {};
let categoryChart, prevMonthChart;

document.getElementById("currentMonth").innerText = `${month + 1}/${year}`;

// --- Dark Mode ---
function toggleDark(){document.body.classList.toggle("dark");}

// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyCDAMWFFDy3mgzbiGzqNdm7idHVUZ8tPoI",
  authDomain: "smartbudget-1ecac.firebaseapp.com",
  databaseURL: "https://smartbudget-1ecac-default-rtdb.firebaseio.com",
  projectId: "smartbudget-1ecac",
  storageBucket: "smartbudget-1ecac.firebasestorage.app",
  messagingSenderId: "758176413916",
  appId: "1:758176413916:web:9c3fe710d752b5371c1c19"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- Month Navigation ---
function prevMonth(){changeMonth(-1);}
function nextMonth(){changeMonth(1);}
function changeMonth(diff){
  month += diff;
  if(month < 0){ month = 11; year--; }
  if(month > 11){ month = 0; year++; }
  document.getElementById("currentMonth").innerText = `${month+1}/${year}`;
  loadExpenses();
}

// --- Add Expense ---
function addExpense(){
  const dateInput = document.getElementById("date").value;
  const desc = document.getElementById("desc").value;
  const amount = +document.getElementById("amount").value;
  const category = document.getElementById("category").value;
  const dateObj = new Date(dateInput);
  const today = new Date();

  // Validation for month/year
  if(dateObj > today){
    alert("ðŸš« You cannot add expenses for future months.");
    return;
  }
  if(dateObj.getMonth() < today.getMonth() || dateObj.getFullYear() < today.getFullYear()){
    if(!confirm("âš ï¸ This expense belongs to a past month. Do you still want to add it?")) return;
  }

  if(!dateInput || !desc || !amount){alert("Fill all fields!"); return;}
  const ref = db.ref("expenses").push();
  ref.set({date: dateInput, desc, amount, category});
}

// --- Load Expenses ---
function loadExpenses(){
  db.ref("expenses").once("value").then(snapshot=>{
    expenses = snapshot.val() || {};
    renderExpenses();
  });
}

// --- Render Expenses ---
function renderExpenses(){
  const table = document.getElementById("expenseTable");
  table.innerHTML = "";
  let total = 0;
  let prevMonthTotal = 0;
  let categories = {};
  const currentMonthKey = `${year}-${month+1}`;
  const prevMonthDate = new Date(year, month-1);
  const prevMonthKey = `${prevMonthDate.getFullYear()}-${prevMonthDate.getMonth()+1}`;

  Object.values(expenses).forEach(exp=>{
    const expDate = new Date(exp.date);
    const expKey = `${expDate.getFullYear()}-${expDate.getMonth()+1}`;
    if(expKey === currentMonthKey){
      total += exp.amount;
      categories[exp.category] = (categories[exp.category]||0) + exp.amount;
    }
    if(expKey === prevMonthKey) prevMonthTotal += exp.amount;

    const row = `<tr>
      <td>${exp.date}</td><td>${exp.desc}</td><td>${exp.category}</td><td>â‚¹${exp.amount}</td>
    </tr>`;
    table.innerHTML += row;
  });

  const remaining = SALARY - total;
  const cumulative = Math.max(0, remaining);

  document.getElementById("totalExpenses").innerText = total;
  document.getElementById("remaining").innerText = remaining;
  document.getElementById("cumulative").innerText = cumulative;

  // Category chart
  if(categoryChart) categoryChart.destroy();
  categoryChart = new Chart(document.getElementById("categoryChart"), {
    type: "pie",
    data: { labels: Object.keys(categories), datasets:[{data:Object.values(categories), backgroundColor:['#4e73df','#1cc88a','#36b9cc','#f6c23e','#e74c3c','#858796']}] }
  });

  // Previous month comparison
  if(prevMonthChart) prevMonthChart.destroy();
  prevMonthChart = new Chart(document.getElementById("prevMonthChart"),{
    type:"bar",
    data:{labels:["Previous Month","Current Month"], datasets:[{label:"Expenses", data:[prevMonthTotal,total], backgroundColor:['#1cc88a','#4e73df']}]}
  });
}

loadExpenses();
</script>
</body>
</html>
